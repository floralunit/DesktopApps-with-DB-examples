# Задание для ДЭ

Постарайтесь не особо распростронять этот репозиторий между другими людьми, потому что я не знаю, можно ли некоторые вещи было
расписывать так подробно (в плане оценки) и не попадёт ли кому-то за это.

На данный момент репозиторий содержит в себе
WPF приложение которое выполняет задание на
~27 баллов, с учётом того, что все судейские
критерии незачтены и некоторые критерии, кажутся
**мне** сомнительными и я не совсем понимаю как
это будет оцениваться на экзамене.
Я буду ещё немного доделывать это приложение,
сейчас просто реализован функционал который показался мне самым лёгким
для того чтобы набрать минимальное количество баллов для пятёрки.

## Что можно сделать и на что обратить внимание для получения определённой оценки

Для того чтобы получить 3 - Загрузить данные в БД, Создать страницы LoginPage и ProductPage и повторить их функционал. (Но много функционала из ProductPage,
может быть опущено, но не увлекайтесь)

Для того чтобы получить 4 - Нужно в принципе всё тоже самое, только уже полностью повторить LoginPage и ProductPage и обязательно соблюдать руководство
по стилю.

Для того чтобы получить 5 - Плюсом к предыдущему реализовать страницу просмотра заказов, для админа и менеджера, 
обрабатывать все ошибки и соблюдать все стили написания кода (чтобы это не значило. Это вот один из критериев 
которые я без понятия как они буду оценивать).

В принципе можно вытянуть на 5, даже если вы реализуете только LoginPage и ProductPage, но они должны быть идеалными, как и всё, что 
относится к коду и его комментированию, чтобы получить максимальные судейские оценки. 
Немного математики БД = 7 Логин = 2,10 Список товаров = 9,70.

*Итог за 2 страницы + БД = 18,80*

Страница LoginPage (Авторизация) - **готова**

Страница ProductPage (Список товаров) - **готова**

Страница CartPage (Формирование заказа) - **нужно много переделать** (пока можно не смотреть)

Страница OrdersPage и OrderProductListPage (Работа с заказами) - **нужно переделать** (какой-то функционал уже можно разобрать)

Для того чтобы получить баллы за 3-й вид критериев:
1. Устанвоите иконку и лого
2. Задайте все стили (App.xaml)
3. Установить MinHeigth и MinWidth у главного окна
4. Запихните всё, что может "уронить" ваше приложение в try {} catch {}
5. Попробуйте оставить хоть какие-то комментарии

**Этот пункт я написал просто открыв критерии и не обещаю, что на экзамене будет считаться всё именно так**

(В критерях, максимальное кол-во баллов
39,5, а не как нам говорили 30,5)

## Что необходимо сделать для того, чтобы запустить данную прогу у себя

1. Запустить команду для воссоздания сущностей и контекста БД;

*Scaffold-DbContext "Server=$НАЗВАНИЕ_ВАШЕГО_СЕРВЕРА_В_MANAGMENT_STUDIO$;Database=$НАЗВАНИЕ_ВАШЕЙ_БД$;Trusted_Connection=True;" 
-OutputDir Entities
-ContextDir Context 
-Force*


**Если интересно**: 

-OutputDir - нужно для того, чтобы не создавать вручную папку Entites и неперетаскивать созданные сущности

-ContextDir - аналогично, только для файла Context

-Force - флаг для того, чтобы устранить конфликты имён (например если таблицы называются также)

*Если у вас будут сильно отличаться названия таблиц от которых есть у меня, будет немного сложнее сделать так чтобы заработало.*

*Тут два пути, либо запоминать и понимать, какие таблицы различаются у меня и у вас или называть таблиц таким же образом*

*Если вы запоминали, то мои таблицы, после выполнения команды, надо будет удалить, если таблицы называются точно также, 
то всё должно быть хорошо и удалять ничего не надо*

2. Устранить все ошибки

Тут самое сложное, необходимо понимать как столбцы у каких сущностей я беру для запросов и вычислений.
Я не знаю даже какие подсказки тут оставить, потому что если хотите запустить приложение и названия полей
в таблицах в БД у вас отличаются от моих, то исправлять придётся много, но в этом есть свой плюс, если 
сесть и нормально разобраться, что за, что отвечает, то вам будет проще на экзамене. Ниже, я напишу
небольшой гайдик про сущности в EF и как хоть немного вникнуть в это.

Также в этот пункт входит устранение небольших логических ошибок, которые могут заключаться например
в различии номеров ролей присвоенных в БД. У меня это 1 - Клиент, 2 - Администратор, 3 - Менеджер.
В принципе, это вроде единственная логическая ошибка с которой можно столкнуться, но я не уверен.

____

В принципе это было два основных пункта которые надо выполнить для того чтобы вы могли посмотреть
как выглядит функционал приложения. Дальше я постараюсь добавить какие-то краткие пояснялки, чтобы
хоть немного стало понятнее, что, куда и зачем :^)

____

1. Как реализуется критерий "Данные при авторизации из базы данных"

Необходимо создать классы наших таблиц с помощью команду Scaffold-DbContext.

Подготовить форму (Написать xaml код (LoginPage.xaml))

В файле App.xaml.cs, создать объект пользователя (currentUser) и БД (db),
где DemoContext - небходимо заменить названием вашей БД + Context.

![image](https://user-images.githubusercontent.com/34215956/159259362-a1a99468-1186-4c64-bdc8-d14b7a6ea705.png)

Обработать нажатию по клику на кнопку войти (buttonLogin_Click)

В коде обработки нажатия на кнопку "Войти" необходимо:

Для того чтобы приложение не могло вылететь при обращении к БД, открыть блок try {} catch {},
затем, в этом блоке необходимо сделать запрос и записать его результат в объявленную переменную (currentUser) 
в файле App.xaml.cs.

![image](https://user-images.githubusercontent.com/34215956/159260143-76b64db5-01c3-47d1-bb2e-0d7fb5f6ff5d.png)

При попытке написать данные код, может возникнуть ошибка, что метод FirstOrDefaultAsync не найден.

![image](https://user-images.githubusercontent.com/34215956/159260447-3fa7a379-e1cc-4e28-9b8e-89e9302aa5ac.png)

Для решения этой и подобных проблем можно использовать сочетание клавиш Ctrl + . или  Alt + Enter, после
чего будет выведена подсказка о отсутсвии необходимого пространства имён в данном файле.

![image](https://user-images.githubusercontent.com/34215956/159260673-684b4f0a-5a9a-4ce6-aff6-01088e7d90b5.png)

Просто нажимаете Enter и среда разработки сама добавляет необходимое пространство имён наверх ко всем using'ам.
Каждый раз когда возникает какая-то похожая ошибка сначала попробуйте посмотреть какие решения предлагает 
среда разработки.

Теперь вернёмся к самому запросу. Для того чтобы его выполнить мы используем лямбда-выражение где 
буква 'е' перед знаком лямбды (=>), грубо говоря создаёт объект нашей таблицы со всеми полями из базы данных,
из-за чего мы можем получить значение логина пользователя и сравнить его с тем, что ввёл пользователь.

Если запрос прошёл успешно и пользователь с такими данными найден, то возрващяется объект из базы данных, с
данными пользователя к которому подошли введённые данные с формы и записывается в переменную.

Дальше можете увидеть по коду в файле LoginPage.xaml.cs, что происходят различные проверки, с помощью которых
мы узнаём, удалось ли найти такого пользователя и какая по счёт попытка войти, для того чтобы знать, когда нам
необходимо вывести каптчу или заблокировать кнопку.
